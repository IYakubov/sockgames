<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SockTank - Create Game</title>
  <style>
    @font-face {
      font-family: 'Unbounded';
      src: url('/fonts/Unbounded-VariableFont_wght.ttf') format('truetype');
      font-weight: 100 900;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%;
      background: #F3EFD4;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: clamp(20px, 3.5vw, 44px);
      font-family: 'Unbounded', sans-serif;
      overflow: hidden;
    }

    /* ── Player count selection screen ── */
    #select-screen {
      display: flex; flex-direction: column;
      align-items: center; gap: clamp(24px, 4vw, 52px);
    }
    #select-screen h2 {
      font-size: clamp(22px, 4vw, 60px);
      color: #1a1a1a; text-align: center;
    }
    .count-btns {
      display: flex; gap: clamp(16px, 3vw, 48px);
    }
    .count-btn {
      width: clamp(80px, 12vw, 180px);
      height: clamp(80px, 12vw, 180px);
      background: #1a1a1a; border: none; border-radius: 16px;
      color: #F3EFD4; font-family: 'Unbounded', sans-serif;
      font-size: clamp(28px, 5vw, 72px); font-weight: 700;
      cursor: pointer; transition: transform 0.1s, background 0.1s;
      display: flex; align-items: center; justify-content: center;
    }
    .count-btn:hover  { background: #782F2F; transform: scale(1.06); }
    .count-btn:active { transform: scale(0.97); }

    /* ── Lobby / code screen ── */
    #lobby-screen { display: none; flex-direction: column; align-items: center; gap: clamp(16px, 3vw, 40px); }
    #share-label  { font-size: clamp(22px, 4vw, 60px); color: #1a1a1a; text-align: center; }
    #code-display {
      font-size: clamp(44px, 9vw, 130px);
      font-weight: 700; color: #1a1a1a;
      letter-spacing: clamp(8px, 2vw, 28px); text-align: center;
    }
    #player-status { font-size: clamp(13px, 2vw, 28px); color: #555; text-align: center; min-height: 1.5em; }
    #error-msg     { color: #782F2F; font-size: clamp(12px, 1.6vw, 22px); min-height: 1.2em; text-align: center; }

    .svgbtn {
      background: none; border: none; cursor: pointer; padding: 0;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.1s, filter 0.1s;
    }
    .svgbtn img { width: clamp(140px, 20vw, 300px); height: auto; }
    .svgbtn:hover  { transform: scale(1.05); filter: brightness(0.9); }
    .svgbtn:active { transform: scale(0.97); }
    #ready-btn { opacity: 0.35; pointer-events: none; }
    #ready-btn.active { opacity: 1; pointer-events: all; }
  </style>
</head>
<body>

  <!-- Step 1: Choose player count -->
  <div id="select-screen">
    <h2>How many players?</h2>
    <div class="count-btns">
      <button class="count-btn" onclick="createRoom(2)">2</button>
      <button class="count-btn" onclick="createRoom(3)">3</button>
      <button class="count-btn" onclick="createRoom(4)">4</button>
    </div>
  </div>

  <!-- Step 2: Share code lobby -->
  <div id="lobby-screen">
    <div id="share-label">Share this Code</div>
    <div id="code-display">- - - - - -</div>
    <div id="player-status">Waiting for players… (0/?)</div>
    <div id="error-msg"></div>
    <button class="svgbtn" id="ready-btn" onclick="startGame()">
      <img src="/svg/ready.svg" alt="Ready">
    </button>
  </div>

  <script>
    let ws = null;
    let roomCode = null;
    let playerCount = 0;
    let neededCount = 0;

    function createRoom(count) {
      neededCount = count;
      document.getElementById('select-screen').style.display = 'none';
      document.getElementById('lobby-screen').style.display = 'flex';
      document.getElementById('player-status').textContent = 'Waiting for players… (0/' + count + ')';

      wconst wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
ws = new WebSocket(wsProtocol + '//' + location.host);
      ws.onopen = function() {
        ws.send(JSON.stringify({ type: 'create_room', playerCount: count }));
      };
      ws.onmessage = function(e) {
        const msg = JSON.parse(e.data);

        if (msg.type === 'room_created') {
          roomCode = msg.code;
          document.getElementById('code-display').textContent = msg.code.split('').join(' ');
        }
        if (msg.type === 'player_joined') {
          playerCount = msg.count;
          const status = document.getElementById('player-status');
          if (playerCount >= neededCount) {
            status.textContent = '✓ All players joined! Press Ready.';
            document.getElementById('ready-btn').classList.add('active');
          } else {
            status.textContent = 'Players joined: ' + playerCount + '/' + neededCount;
          }
        }
        if (msg.type === 'countdown_start') {
          sessionStorage.setItem('role', 'host');
          sessionStorage.setItem('code', roomCode);
          ws.send(JSON.stringify({ type: 'host_navigating' }));
          setTimeout(function() { location.href = '/game?code=' + roomCode; }, 80);
        }
        if (msg.type === 'error') {
          document.getElementById('error-msg').textContent = msg.message;
        }
      };
    }

    function startGame() {
      if (playerCount < neededCount) return;
      ws.send(JSON.stringify({ type: 'start_game' }));
    }
  </script>
</body>
</html>
